# Ручная калибровка 3D-принтера Micromake D1

## \*\*Внимание! Этот учебник устарел — читайте вместо него [эту статью в 2 частях](https://github.com/Bougakov/Micromake-D1-3D-printer/blob/master/Installing%20custom%20firmware.md) \*\*

Это руководство изначально было написано для [группы пользователей Micromake на Facebook](https://www.facebook.com/groups/173676226330714/).

Долгое время я не мог напечатать что-либо диаметром более 5 см на своём Micromake D1. Функция “Auto level” в CURA никогда не работала у меня хорошо. Вот что я получал на [модели тестовой пластины с Thingiverse](http://www.thingiverse.com/thing:1549840) даже с допуском в 0,04 мм:

![Full plate test](https://raw.githubusercontent.com/Bougakov/Micromake-D1-3D-printer/master/images/leveling0.png)

А теперь я добился такого качества при толщине слоя 0,15 мм даже для полной пластины:

![Full plate test](https://raw.githubusercontent.com/Bougakov/Micromake-D1-3D-printer/master/images/leveling1.jpg)

Меня вдохновило это видео от проекта Repetier. К сожалению, там используются команды, которых Micromake D1 не поддерживает, поэтому я буду использовать только часть, посвящённую измерению смещений каждой вертикальной башни.

[![Видео от Repetier](http://img.youtube.com/vi/L9URtv2LqKc/0.jpg)](http://www.youtube.com/watch?v=L9URtv2LqKc&t=5)

Вам понадобится:

* что-то длинное, например стальная линейка \~30 см или металлический стержень 30–40 см
* калькулятор (подойдёт Windows `calc.exe`)
* [этот онлайн-калькулятор Escher3D](http://escher3d.com/pages/wizards/wizarddelta.php) (открыть в новой вкладке)
* 5–10 минут времени
* любое ПО для отправки команд на COM-порт. Я использовал Repetier Host, но можно воспользоваться даже Arduino *Serial Monitor* — просто установите скорость 250 000 бод и подключитесь.

Вот куда вводить G-коды в Repetier:

![gcode input in Repetier](https://raw.githubusercontent.com/Bougakov/Micromake-D1-3D-printer/master/images/gcode%20input%20in%20Repetier.png)

---

## Немного теории

У дельта-принтеров множество переменных:

![Rods and offsets](https://www.repetier.com/firmware/v092/images/deltacolumnnames2.png)

Неровности длины тяг и небольшие смещения башен даже на доли градуса дают большие погрешности.

Калибровка сводится к решению уравнения с **семью** переменными:

1. три коррекции концевиков
2. радиус дельты
3. два угловых смещения башен
4. длина диагональных тяг

При этом все они по-разному называются: башни могут быть X, Y, Z или A, B, C, а углы их расположения (90°, 210°, 330°) тоже именуют A, B, C. Ещё где-то миллиметры, где-то шаги моторов… Чтобы не запутаться:

![Names explained](https://raw.githubusercontent.com/Bougakov/Micromake-D1-3D-printer/master/images/Explainer2.png)

---

# Приступаем к калибровке

## Шаг 1 — сброс данных автолевелинга

1. Проверьте натяжение всех трёх ремней и затяните ослабшие винты. Проверьте концевики.
2. Если печатаете ABS, предварительно прогрейте принтер (через «Quick settings» → «Preheat ABS»), чтобы все металлические детали расширились.
3. Подключитесь к COM-порту и выполните:

   ```
   G28    ; Homing всех осей
   M321   ; Деактивация автолевелинга
   M322   ; Сброс матрицы автолевелинга
   ```

   Это полностью очистит настройки выравнивания.

## Шаг 2 — измерение смещений концевиков

1. Поднимите каретку до отметки 200 мм:

   ```
   G1 X0 Y0 Z200   ; Переместить экструдер на 200 мм от стола
   ```
2. Определите, какая башня называется X, Y, Z (относительно экрана), и наклейте на каждую бумажный ярлык с буквой.
3. Для башни X:

   ```
   M99 X0   ; Отключить мотор башни X на 10 секунд
   ```

   Отсоединённая каретка опустится и коснётся линейки. Удерживайте линейку, пока мотор не включится снова, затем снимите линейку.
4. То же для Y и Z:

   ```
   M99 Y0
   M99 Z0
   ```
5. Теперь расстояние от каждой башни до стола одинаково. Зафиксируйте это в EEPROM:

   ```
   G132 S1   ; Вычислить и сохранить смещения концевиков
   ```

   Вы увидите в ответ:

   ```
   Tower 1:344
   Tower 2:305
   Tower 3:100
   ```

   Запишите эти числа и внесите их в EEPROM (в Repetier — Alt+E, в CURA — Machine → Firmware configuration).
6. Снова:

   ```
   G28   ; Homing для применения изменений
   ```

## Шаг 3 — точное измерение высоты принтера

1. Я изменил хранимое значение `Z max length [mm]` с 329.260 мм на округлённые 340 мм (добавил 10 мм “про запас”). Записать в EEPROM можно через Machine → Firmware configuration.
2. Сделать homing и опустить экструдер на “20 мм”:

   ```
   G28
   G1 X0 Y0 Z20
   ```
3. На экране принтера открыть Configuration → Z calib. → Z position. Очень медленно вращать ручку против часовой стрелки, пока сопло не коснётся стола (когда звук вентилятора изменится). **Нельзя крутить быстро — риск лобового столкновения!**
4. Записать показание Z position. В калькуляторе вычесть его из значения `Z max length`. Получите реальную высоту печати.
5. Можно не вычислять вручную, а при касании стола выбрать Set Z=0 — принтер сам проставит ноль.

Теперь известны четыре из семи переменных.

## Шаг 4 — расчёт в онлайн-калькуляторе Escher3D

1. Откройте [Escher3D Wizard Delta](http://escher3d.com/pages/wizards/wizarddelta.php).

2. Заполните поля:

   | Параметр                             | Что ввести                                            |
   | ------------------------------------ | ----------------------------------------------------- |
   | Firmware type                        | Repetier                                              |
   | Steps/mm                             | 100 (или 200 при 1/32-микрошаге)                      |
   | Initial endstop corrections          | Смещения X, Y, Z из шага 2                            |
   | Initial diagonal rod length          | 217 мм (или вашу длину от отверстия до отверстия)     |
   | Initial delta radius                 | 95 мм                                                 |
   | Initial homed height                 | Ваше значение из шага 3                               |
   | Initial tower angular position corr. | Оставьте 0                                            |
   | Printable bed radius                 | Например, 75–80 мм                                    |
   | Number of probe points               | 10                                                    |
   | Number of factors to calibrate       | 7 (или 6, если жёстко зафиксировать длину диагоналей) |
   | Normalize endstops                   | Оставьте unchecked                                    |

3. Нажмите **Calculate** — калькулятор предложит 10 координат точек для зондирования.

4. Удобнее не крутить ручку, а сразу отправлять G-коды. Пример для 10 точек:

   ```gcode
   G28
   G1 X0.00  Y75.00  Z20   ; Точка 0
   G28
   G1 X64.95 Y37.50 Z20   ; Точка 1
   G28
   G1 X64.95 Y-37.50 Z20  ; Точка 2
   G28
   G1 X0.00  Y-75.00 Z20  ; Точка 3
   G28
   G1 X-64.95 Y-37.50 Z20 ; Точка 4
   G28
   G1 X-64.95 Y37.50 Z20  ; Точка 5
   G28
   G1 X0.00  Y37.50 Z20  ; Точка 6
   G28
   G1 X32.48 Y-18.75 Z20 ; Точка 7
   G28
   G1 X-32.48 Y-18.75 Z20; Точка 8
   G28
   G1 X0     Y0     Z20  ; Точка 9
   G28                    ; Вернуться домой
   ```

5. На каждой точке вручную добейте сопло до стола меню Configuration → Z position и выпишите показание.

   * Если экран показывает +1.23 мм при касании — введите −1.23 в форму.
   * Если показывает −1.22 мм — введите +1.22.

6. После расчёта калькулятор выдаст новые корректирующие значения. Сохраните их в EEPROM, **используя точку как разделитель** (русскую запятую не применять):

   | Вычисленное значение                | Куда вписать в EEPROM                                        |
   | ----------------------------------- | ------------------------------------------------------------ |
   | New endstop corrections X, Y, Z     | Tower X/Y/Z endstop offset (округлить до целого)             |
   | New diagonal rod length             | Diagonal rod length                                          |
   | New delta radius                    | Horizontal rod radius at 0,0                                 |
   | New homed height                    | Z max length                                                 |
   | New tower angle corrections A, B, C | Прибавить/вычесть к Alpha A(210), B(330), C(90) (в градусах) |

7. Включите автолевелинг обратно:

   ```
   M320 S2   ; Активировать автоуровень навсегда
   ```

8. **При желании** повторите шаг 4 ещё раз — я получил “deviation before 0.44, after 0.04” уже после двух проходов!

В результате вы добьётесь точности \~0,04 мм в любой точке стола. Пример 11×11 см ABS-печати без подъёма углов:

![Results](https://raw.githubusercontent.com/Bougakov/Micromake-D1-3D-printer/master/images/leveling3.jpg)
